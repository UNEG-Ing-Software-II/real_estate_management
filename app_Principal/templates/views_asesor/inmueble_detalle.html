{% extends 'base/base.html' %}

{% load static %}

{% block extra_styles %}
<link rel="stylesheet" href="{% static 'styles/style.css' %}">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
crossorigin=""/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
crossorigin=""></script>
<style>

    #map {
        height: 169px;
        width: 350px;
        margin: 10px 20px;
    }

    @media (max-width: 555px) {
        #map {
            width: 70%;
            margin: 10px 20px;
        }
    }

    .carousel-item {
        width: 100%;
        height: 100%;
    }

    .carousel-image{
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .carousel-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .carousel-item.active {
        margin: 0;
        padding: 0;
    }

    .existing-images {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
    }

    .image-container {
        position: relative;
        display: inline-block;
    }

    .existing-image {
        width: 100px;
        height: 100px;
        object-fit: cover;
        border: 1px solid #ccc;
    }

    .btn-img{
        position: absolute;
        top: 5px;
        right: 5px;
    }


</style>

{% endblock %}

{% block dynamic_button %}

    <div class="gap">
        <button type="button" class="btn btn-secondary rounded-pill px-4 py-2 in" data-bs-toggle="modal" data-bs-target="#modalAgregarPropietario" >
            <i class="bi bi-person-fill-add"></i>Gestionar Propietarios</button>
    </div>

    <div class="modal fade" id="modalAgregarPropietario" tabindex="-1" aria-labelledby="modalAgregarPropietarioLabel" aria-hidden="true">
        <div class="modal-dialog ">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5 text-center" id="modalAgregarPropietarioLabel">Agregar o eliminar propietarios de "{{inmueble.nombre}}"</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Pestañas de navegación -->
                    <ul class="nav nav-tabs" id="myTab" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="buscar-tab" data-bs-toggle="tab" data-bs-target="#buscar" type="button" role="tab" aria-controls="buscar" aria-selected="true">Agregar por Cédula</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="registrar-tab" data-bs-toggle="tab" data-bs-target="#registrar" type="button" role="tab" aria-controls="registrar" aria-selected="false">Registrar Nuevo P.</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="eliminar-tab" data-bs-toggle="tab" data-bs-target="#eliminarPropietarios" type="button" role="tab" aria-controls="eliminarPropietarios" aria-selected="false">Eliminar P.</button>
                        </li>
                    </ul>
    
                    <div class="tab-content" id="myTabContent">
                        <!-- Formulario de búsqueda por cédula -->
                        <div class="tab-pane fade show active" id="buscar" role="tabpanel" aria-labelledby="buscar-tab">
                            <form id="formBuscar" class="d-flex align-items-center">
                                <div class="mb-3 mt-3">
                                    <label for="cedulaBuscar" class="form-label">Número de Cédula <i>(propietario)</i></label>
                                    <div class="d-flex mx-auto">
                                        <input type="text" inputmode="numeric" pattern="[0-9]*" class="form-control" id="cedulaBuscar" placeholder="Ingrese el número de cédula">
                                        <button type="submit" class="btn btn-primary ms-2">Buscar</button>   
                                    </div>
                                </div>
                            </form>
                            <div id="resumenPropietario" class="mt-3"></div>
                        </div>
    
                        <!-- Formulario de registro completo -->
                        <div class="tab-pane fade" id="registrar" role="tabpanel" aria-labelledby="registrar-tab">
                            <form id="formRegistro">
                                <div class="mt-4 mb-3">
                                    <label for="cedulaRegistrar" class="form-label">Número de Cédula</label>
                                    <input type="text" inputmode="numeric" pattern="[0-9]*" class="form-control" id="cedulaRegistrar" placeholder="Ingrese el número de cédula" required>
                                </div>
                                <div class="mb-3">
                                    <label for="nombre" class="form-label">Nombre</label>
                                    <input type="text" class="form-control" id="nombre" placeholder="Ingrese el nombre" required>
                                </div>
                                <div class="mb-3">
                                    <label for="apellido" class="form-label">Apellido</label>
                                    <input type="text" class="form-control" id="apellido" placeholder="Ingrese el apellido" required>
                                </div>
                                <div class="mb-3">
                                    <label for="correo" class="form-label">Correo</label>
                                    <input type="email" class="form-control" id="correo" placeholder="Ingrese un correo" required>
                                </div>
                                <div class="mb-3">
                                    <label for="password" class="form-label">Contraseña</label>
                                    <input type="password" class="form-control" id="password" placeholder="Ingrese una contraseña" required>
                                </div>
                                
                            </form>
                        </div>

                        <!-- Formulario para eliminar propietarios -->
                        <div class="tab-pane fade" id="eliminarPropietarios" role="tabpanel" aria-labelledby="eliminar-tab">
                            <form id="eliminarForm" action="{% url 'eliminar_propietarios' %}" method="post">
                                {% csrf_token %}
                                {% if propietarios%}
                                    {% for propietario in propietarios %}
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="propietario{{ propietario.id }}" name="propietarios_seleccionados" value="{{ propietario.id }}">
                                            <label class="form-check-label" for="propietario{{ propietario.id }}">
                                                {{propietario.persona_id.cedula}} - {{ propietario.persona_id.nombre }} - {{ propietario.persona_id.apellido }}
                                            </label>
                                        </div>
                                    {% endfor %}
                                {% else %}
                                    <p class=" mt-3 text-center"><b>No hay propietarios asignados para este inmueble</b></p>
                                {% endif %}
                            </form>
                        </div>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                    <button type="button" class="btn btn-primary" id="guardarBtn" disabled>Agregar Propietario</button>
                    <button type="button" class="btn btn-primary d-none" id="registrarBtn">Registrar</button>
                    <button type="button" class="btn btn-danger d-none" id="eliminarBtn" disabled>Eliminar seleccionados</button>
                </div>
            </div>
        </div>
    </div>

    
    <!-- Formulario oculto -->
    <form id="hiddenForm" action="{% url 'guardar_propietario' %}" method="POST" style="display:none;">
        {% csrf_token %}
        <input type="hidden" id="hiddenCedula" name="cedula">
        <input type="hidden" id="hiddenNombre" name="nombre">
        <input type="hidden" id="hiddenApellido" name="apellido">
        <input type="hidden" id="hiddenCorreo" name="correo">
        <input type="hidden" id="hiddenPassword" name="password">
        <input type="hidden" id="hiddenMethod" name="method">
        <input type="hidden" id="hiddenInmuebleId" name="inmueble_id" value="{{inmueble.id}}">
    </form>
    

    <div class="gap">
        <button type="button" class="btn btn-secondary rounded-pill px-4 py-2 in" ><i class="bi bi-building-add"></i>Agregar Area</button>
    </div>

    <div class="gap">
        <button type="button" class="btn btn-secondary rounded-pill px-4 py-2 in" onclick="visible()"><i class='bx bx-edit'></i>Editar</button>
    </div>

    <div class="gap"> 
        <button class="btn-delete" type="button" data-bs-toggle="modal" data-bs-target="#modalBorrar{{ inmueble.id }}"><i class='bx bx-trash' ></i>Eliminar</button>
    </div>

    <!-- Modal para Borrar Inmueble-->
    <div class="modal fade" id="modalBorrar{{ inmueble.id }}" tabindex="-1" aria-labelledby="modalBorrarLabel{{ inmueble.id }}" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <div>
                        <h5 class="modal-title">Eliminar inmueble "{{ inmueble.nombre }}"</h5>
                        <h4 class="text-dark"> ID del inmueble: {{inmueble.id}}</h4> 
                    </div>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form action="{% url 'eliminar_inmueble' inmueble.id %}" method="post">
                    {% csrf_token %}
                    <div class="modal-body">
                        <p>¿Estás seguro que deseas eliminar este inmueble?</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                        <button type="submit" class="btn btn-danger">Eliminar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

{% endblock %}

{% block content %}
<body id="Fondo">
    <div class="container-center">
        <div class="center">
            <div class="block">


                <div class="carousel align-self-center">
                    {% if imagenes_inmueble %}
                        <div id="carousel_imagenes" class="carousel slide m-0 p-0">
                            <div class="carousel-inner ">
                                {% for img in imagenes_inmueble %}
                                    <div class="carousel-item {% if forloop.first %} active {% endif %} ">
                                        <img src="{{ img.foto.url }}" class="d-block carousel-image" alt="">
                                    </div>
                                {% endfor %}

                                <button class="carousel-control-prev" type="button" data-bs-target="#carousel_imagenes" data-bs-slide="prev">
                                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                    <span class="visually-hidden">Previous</span>
                                </button>
                                <button class="carousel-control-next" type="button" data-bs-target="#carousel_imagenes" data-bs-slide="next">
                                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                    <span class="visually-hidden">Next</span>
                                </button>
                            </div>
                        </div>

                    {% else %}
                        <img src="{% static 'img/Inmueble1.jpeg' %}" class="inmueble" alt="">
                    {% endif %}
                </div>


                <div class="info">
                    <h1 id="details-title">DETALLES DEL INMUEBLE</h1>
                    <hr>
                    <form class="form-container d-flex" id="form" action="{% url 'modificar_inmueble' inmueble.id %}" enctype="multipart/form-data" method="post">
                        {% csrf_token %}
                        <div id="first-group" class="group active-group">
                            <div class="form-group">
                                <label for="InputNombre">Nombre de la propiedad</label>
                                <input type="text" disabled class="form-control input-control" name="nombre" id="InputNombre" value="{{ inmueble.nombre }}" required>
                            </div>
                            <div class="form-group">
                                <label for="Tipo-Propiedad">Tipo de Propiedad</label>
                                <select class="form-select input-select" name="tipoPropiedad" id="Tipo-Propiedad" aria-label="Default select example" required disabled>
                                    <option selected disabled hidden></option>
                                    <option value="Apartamento" {% if inmueble.tipoPropiedad == 'Apartamento' %} selected {% endif %}>Apartamento</option>
                                    <option value="Town house" {% if inmueble.tipoPropiedad == 'Town house' %} selected {% endif %}>Town house</option>
                                    <option value="Quinta" {% if inmueble.tipoPropiedad == 'Quinta' %} selected {% endif %}>Quinta</option>
                                    <option value="Casa" {% if inmueble.tipoPropiedad == 'Casa' %} selected {% endif %}>Casa</option>
                                    <option value="Galpon" {% if inmueble.tipoPropiedad == 'Galpon' %} selected {% endif %}>Galpon</option>
                                    <option value="Oficina" {% if inmueble.tipoPropiedad == 'Oficina' %} selected {% endif %}>Oficina</option>
                                    <option value="F comercio" {% if inmueble.tipoPropiedad == 'F comercio' %} selected {% endif %}>F comercio</option>
                                    <option value="Otros" {% if inmueble.tipoPropiedad == 'Otros' %} selected {% endif %}>Otros</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="InputEstado">Estado</label>
                                <select class="form-select input-select" aria-label="Default select example" required id="InputEstado" name="estado" disabled>
                                    <option selected disabled hidden></option>
                                    <option value="En venta" {% if inmueble.estado == 'En venta' %} selected {% endif %}>En venta</option>
                                    <option value="En alquiler" {% if inmueble.estado == 'En alquiler' %} selected {% endif %}>En alquiler</option>
                                    <option value="Finalizado" {% if inmueble.estado == 'Finalizado' %} selected {% endif %}>Finalizado</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="InputPrecio">Precio</label>
                                <input type="number" class="form-control input-control" id="InputPrecio" name="precio" value="{{ inmueble.precio }}" min="0.001" step="0.001" disabled required>
                            </div>
                            <div class="form-group">
                                <label for="InputNiveles">Niveles</label>
                                <input type="number" disabled class="form-control input-control" id="InputNiveles" name="niveles" value="{{ inmueble.niveles }}" min="1" step="1" required>
                            </div>
                            <div class="form-group">
                                <label for="InputMetrosTerreno">Metros² del terreno</label>
                                <input type="number" disabled class="form-control input-control" id="InputMetrosTerreno" name="metros_terreno" value="{{ inmueble.metros_terreno }}" min="0.001" step="0.001" required>
                            </div>
                            <div class="form-group">
                                <label for="InputMetrosConstrucción">Metros² de construcción</label>
                                <input type="number" disabled class="form-control input-control" id="InputMetrosConstrucción" name="metros_construccion" value="{{ inmueble.metros_construccion }}" min="0.001" step="0.001" required>
                            </div>
                        </div>
                        <div id="second-group" class="group">
                            <div class="form-group">
                                <label for="InputBathroom" class="form-label">Baño</label>
                                <input type="checkbox" disabled class="form-check-input" name="bathroom" id="InputBathroom" {% if inmueble.bathroom %} checked {% endif %}>
                            </div>
                            <div class="form-group">
                                <label for="InputCuartoServicio" class="form-label">Cuarto de servicio</label>
                                <input type="checkbox" disabled class="form-check-input" name="cuarto_servicio" id="InputCuartoServicio" {% if inmueble.cuarto_servicio %} checked {% endif %}>
                            </div>
                            <div class="form-group">
                                <label for="InputOficina" class="form-label">Oficina</label>
                                <input type="checkbox" disabled class="form-check-input" name="oficina" id="InputOficina" {% if inmueble.oficina %} checked {% endif %}>
                            </div>
                            <div class="form-group">
                                <label for="InputEstacionamiento" class="form-label">Estacionamiento</label>
                                <input type="checkbox" disabled class="form-check-input" name="estacionamiento" id="InputEstacionamiento" {% if inmueble.estacionamiento %} checked {% endif %}>
                            </div>
                            <div class="form-group">
                                <label for="InputHalfBath" class="form-label">Medio baño</label>
                                <input type="checkbox" disabled class="form-check-input" name="half_bath" id="InputHalfBath" {% if inmueble.half_bath %} checked {% endif %}>
                            </div>
                            <div class="form-group">
                                <label for="InputTerraza" class="form-label">Terraza</label>
                                <input type="checkbox" disabled class="form-check-input" name="terraza" id="InputTerraza" {% if inmueble.terraza %} checked {% endif %}>
                            </div>
                            <div class="form-group">
                                <label for="InputHabitacion" class="form-label">Habitación</label>
                                <input type="checkbox" disabled class="form-check-input" name="habitacion" id="InputHabitacion" {% if inmueble.habitacion %} checked {% endif %}>
                            </div>
                            <div class="form-group">
                                <label for="InputMaletero" class="form-label">Maletero</label>
                                <input type="checkbox" disabled class="form-check-input" name="maletero" id="InputMaletero" {% if inmueble.maletero %} checked {% endif %}>
                            </div>
                        </div>

                        <div id="third-group" class="group">
                            <div class="form-group">
                                <label for="InputDireccion" class="form-label">Dirección</label>
                                <input type="text" disabled class="form-control input-control" name="direccion" id="InputDireccion" value="{{ inmueble.direccion }}" required>
                            </div>
                            <div class="form-group">
                                <label for="InputLatitud">Latitud</label>
                                <input type="number" disabled class="form-control input-control" id="InputLatitud" name="latitud" value="{{ inmueble.latitud }}" min="-90" max="90" step="0.00000000000001" required>
                            </div>
                            <div class="form-group">
                                <label for="InputLongitud">Longitud</label>
                                <input type="number" disabled class="form-control input-control" id="InputLongitud" name="longitud" value="{{ inmueble.longitud }}" min="-180" max="180" step="0.00000000000001" required>
                            </div>

                            <div id="map"></div>
                            <script>
                                var map = L.map('map').setView([{{ inmueble.latitud }}, {{ inmueble.longitud }}], 16);
                                L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
                                L.marker([{{ inmueble.latitud }}, {{ inmueble.longitud }}]).addTo(map).bindPopup('Inmueble').openPopup();
                            </script>

                            
                        </div>
                        

                        <div id="fourth-group" class="group mx-auto">
                            
                                <div class="form-group">
                                    <label for="InputFotos" class="form-label">Cargar Fotos</label>
                                    <input type="file" disabled multiple class="form-control input-control"  name="fotos" id="InputFotos" accept="image/*" >
                                </div>
                            
                                {% if imagenes_inmueble %}
                                    <div class="form-group">
                                    <input type="hidden" id="deletedImagesInput" name="deletedImages">
                                    
                                    <label class="form-label">Fotos Cargadas</label>
                                        <div class="existing-images">
                                            {% for img in imagenes_inmueble %}
                                                <div class="image-container" id="image-{{ img.id }}">
                                                    <img src="{{ img.foto.url }}" class="existing-image" alt="Imagen del Inmueble">
                                                    <button type="button" hidden class="btn btn-img btn-danger btn-sm" onclick="deleteImage('{{ img.id }}')" >Eliminar</button>
                                                </div>
                                            {% endfor %}
                                        </div>
                                    </div>
                                {% endif %}
                            
                        </div>

                        <div id="btn-special">
                            <button class="btn-save" type="submit"><i class='bx bx-save'></i>Guardar</button>
                            <button class="btn-x" type="button" onclick="visible()"><i class='bx bx-x second-view'></i>Cancelar</button>
                        </div>
                    </form>

                    <div class="pagination">
                        <button class="btn-pag act-btn" onclick="form_change(this, 'first-group')">1</button>
                        <button class="btn-pag" onclick="form_change(this, 'second-group')">2</button>
                        <button class="btn-pag" onclick="form_change(this, 'third-group')">3</button>
                        <button class="btn-pag" onclick="form_change(this, 'fourth-group')">4</button>
                    </div>

                    
                </div>
            </div>
        </div>
    </div>
    <script src="{% static 'js/pagination.js' %}"></script>
    
    <script>
        const btn_special = document.getElementById("btn-special");
        const Inputs = {
            Propiedad: document.getElementById("Tipo-Propiedad"),
            Estado: document.getElementById("InputEstado"),
            Precio: document.getElementById("InputPrecio"),
            Niveles: document.getElementById("InputNiveles"),
            M_Terrenos: document.getElementById("InputMetrosTerreno"),
            M_Construccion: document.getElementById("InputMetrosConstrucción"),
            Bathroom: document.getElementById("InputBathroom"),
            CuartoServicio: document.getElementById("InputCuartoServicio"),
            Oficina: document.getElementById("InputOficina"),
            Estacionamiento: document.getElementById("InputEstacionamiento"),
            HalfBath: document.getElementById("InputHalfBath"),
            Terraza: document.getElementById("InputTerraza"),
            Habitacion: document.getElementById("InputHabitacion"),
            Maletero: document.getElementById("InputMaletero"),
            Direccion: document.getElementById("InputDireccion"),
            Latitud: document.getElementById("InputLatitud"),
            Longitud: document.getElementById("InputLongitud"),
            Fotos: document.getElementById("InputFotos"), 
            deleteButtons: document.querySelectorAll('.btn-img')
        };
    
        const visible = () => {
            const isDisabled = Inputs.Propiedad.disabled;
            Object.keys(Inputs).forEach(key => {
                Inputs[key].disabled = !isDisabled;
            });
    
            Inputs.deleteButtons.forEach(button => {
                button.hidden = !isDisabled;
            });
                
            btn_special.style.visibility = isDisabled ? "visible" : "hidden";
        };
        
        const deletedImages = [];

        function deleteImage(imageId) {
            const imageContainer = document.getElementById(`image-${imageId}`);
            if (imageContainer) {
                imageContainer.remove();
                deletedImages.push(imageId);
                console.log(deletedImages);
                const deletedImagesInput = document.getElementById('deletedImagesInput');
                const deletedImagesJSON = JSON.stringify(deletedImages);
                deletedImagesInput.value = deletedImagesJSON;
                //console.log(deletedImagesInput);
            }
        }
    
    </script>
    <!--Control de formularios y envios de informacion-->
    <script>
        document.addEventListener('DOMContentLoaded', function () {;

            const buscarForm = document.getElementById('formBuscar');
            const registrarForm = document.getElementById('formRegistro');
            const eliminarForm = document.getElementById('eliminarForm');

            const guardarBtn = document.getElementById('guardarBtn');
            const registrarBtn = document.getElementById('registrarBtn');
            const eliminarBtn = document.getElementById('eliminarBtn');

            const resumenPropietario = document.querySelector('#resumenPropietario');
            const hiddenForm = document.querySelector('#hiddenForm');

            registrarBtn.addEventListener('click', function() {
                registrarForm.requestSubmit();
            });

            guardarBtn.addEventListener('click', function () {
                hiddenForm.submit();
            });

            eliminarBtn.addEventListener('click', function() {
                eliminarForm.requestSubmit();
            });

            const checkboxes = eliminarForm.querySelectorAll('input[type="checkbox"]');
            checkboxes.forEach(checkbox => {
                checkbox.addEventListener('change', function () {
                    const algunSeleccionado = Array.from(checkboxes).some(checkbox => checkbox.checked);
                    eliminarBtn.disabled = !algunSeleccionado;
                });
            });

            buscarForm.addEventListener('submit', function (event) {
                event.preventDefault();
                const cedula = document.querySelector('#cedulaBuscar').value;
        
                fetch(`{% url 'buscar_propietario' %}?cedula=${cedula}&id_inmueble={{ inmueble.id }}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.error) {
                            alert(data.error);
                        } else {
                            // Mostrar el resumen de los datos del propietario en la pestaña de búsqueda
                            resumenPropietario.innerHTML = `
                                <p class="text-center"><b>Datos del usuario propietario</b></p>
                                <span><b>Cédula:</b> ${data.cedula}</span><br>
                                <span><b>Nombre:</b> ${data.nombre}</span><br>
                                <span><b>Apellido:</b> ${data.apellido}</span><br>
                                <span><b>Correo: </b>${data.correo}</span><br>
                                ${data.msg ? `<b><p class="text-danger">${data.msg}</p></b>` : ''}
                            `;

                            if (data.valido === true) {
                                guardarBtn.disabled = false;
                            } else {
                                guardarBtn.disabled = true;
                            }
        
                            // Actualizar los campos ocultos del formulario para enviar los datos al backend
                            document.querySelector('#hiddenCedula').value = data.cedula;
                            document.querySelector('#hiddenNombre').value = data.nombre;
                            document.querySelector('#hiddenApellido').value = data.apellido;
                            document.querySelector('#hiddenCorreo').value = data.correo;
                            document.querySelector('#hiddenMethod').value = 'existente';
                        }
                    })
                    .catch(error => console.error('Error:', error));
            });

            
        
            registrarForm.addEventListener('submit', function (event) {
                event.preventDefault();
                const cedula = document.querySelector('#cedulaRegistrar').value;
                const nombre = document.querySelector('#nombre').value.trim();
                const apellido = document.querySelector('#apellido').value.trim();
                const correo = document.querySelector('#correo').value.trim();
                const password = document.querySelector('#password').value;

                if (!validateForm()) {
                    event.preventDefault();
                    alert('Por favor, complete todos los campos correctamente, no deje campos de texto con solo espacios');
                } else{
                        const data = new FormData();
                        data.append('cedula', cedula);
                        data.append('correo', correo);

                        fetch("{% url 'validar_propietario' %}", {
                            method: 'POST',
                            body: data
                        })
                        .then(response => response.json())
                        .then(data => {
                            if (data.error) {
                                alert(data.error);
                            } else {
                                // Actualizar los campos ocultos del formulario para enviar los datos al backend
                                document.querySelector('#hiddenCedula').value = cedula;
                                document.querySelector('#hiddenNombre').value = nombre;
                                document.querySelector('#hiddenApellido').value = apellido;
                                document.querySelector('#hiddenCorreo').value = correo;
                                document.querySelector('#hiddenPassword').value = password;
                                document.querySelector('#hiddenMethod').value = 'nuevo';
                        
                                // Enviar el formulario oculto
                                hiddenForm.submit();
                            }
                        })
                        .catch(error => console.error('Error:', error));
                    }
            });

            function validateForm() {
                const nombreValido = nombre.value.trim().length > 0;
                const apellidoValido = apellido.value.trim().length > 0;
                return nombreValido && apellidoValido;
            }
        });
    </script>
    <!--Actualizacion en el footer de modal para gestion de propietarios-->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Pestañas
            const buscarTab = document.getElementById('buscar-tab');
            const registrarTab = document.getElementById('registrar-tab');
            const eliminarTab = document.getElementById('eliminar-tab')
        
            // Botones
            const guardarBtn = document.getElementById('guardarBtn');
            const registrarBtn = document.getElementById('registrarBtn');
            const eliminarBtn = document.getElementById('eliminarBtn');
            
            // Funcion para el cambio de pestaña
            function toggleButtons() {
                if (buscarTab.classList.contains('active')) {
                    guardarBtn.classList.remove('d-none');
                    registrarBtn.classList.add('d-none');
                    eliminarBtn.classList.add('d-none');
                } else if (registrarTab.classList.contains('active')) {
                    guardarBtn.classList.add('d-none');
                    registrarBtn.classList.remove('d-none');
                    eliminarBtn.classList.add('d-none');
                } else if (eliminarTab.classList.contains('active')){
                    guardarBtn.classList.add('d-none');
                    registrarBtn.classList.add('d-none');
                    eliminarBtn.classList.remove('d-none');
                }
            }
            
            toggleButtons();
        
            // Cambio de pestaña
            buscarTab.addEventListener('click', toggleButtons);
            registrarTab.addEventListener('click', toggleButtons);
            eliminarTab.addEventListener('click', toggleButtons);
        });
    </script>
        
</body>
{% endblock %}
